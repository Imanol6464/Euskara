
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Euskara Â· Ikasi Â· Niveau 1 (10 leÃ§ons) â€” Light</title>
  <meta name="theme-color" content="#ffffff">
  <style>
/* ================= LIGHT THEME, FLAT ================= */
:root{
  --bg:#f9fafb;           /* very light background */
  --surface:#ffffff;      /* cards */
  --surface-2:#f3f4f6;    /* secondary */
  --border:#e5e7eb;
  --text:#111827;         /* near black */
  --muted:#6b7280;        /* gray-500 */
  --primary:#3b82f6;      /* blue-500 */
  --primary-2:#2563eb;    /* blue-600 */
  --ok:#22c55e;           /* green-500 */
  --warn:#ef4444;         /* red-500 */
  --shadow: 0 8px 24px rgba(17,24,39,.08);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
a{color:var(--primary);text-decoration:none}
header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.8);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid var(--border)}
.container{max-width:1000px;margin:0 auto;padding:12px 16px}
.brand{display:flex;align-items:center;gap:12px}
.logo{display:grid;place-items:center;width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--primary),#60a5fa);color:white;font-weight:900}
.title h1{margin:0;font-size:20px;letter-spacing:.2px}
.title small{color:var(--muted)}
main{max-width:1000px;margin:18px auto 64px auto;padding:0 16px}
.grid{display:grid;gap:16px;grid-template-columns: 1fr}
@media (min-width: 880px){ .grid{grid-template-columns: 360px 1fr} }
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
.card h2{margin:6px 0 10px}
.badge{display:inline-flex;align-items:center;gap:6px;font-weight:700;background:#eff6ff;border:1px solid #dbeafe;color:#1d4ed8;padding:4px 10px;border-radius:999px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{appearance:none;border:none;cursor:pointer;font-weight:700;border-radius:12px;padding:14px 16px;background:#eef2ff;border:1px solid #e5e7eb;color:#1f2937;min-height:48px}
.btn:active{transform:translateY(1px)}
.btn.primary{background:linear-gradient(180deg,#93c5fd,#60a5fa);color:#0b255a;border:none}
.btn.ghost{background:#ffffff;border:1px solid var(--border)}
.btn.ok{background:linear-gradient(180deg,#86efac,#22c55e);color:#063d1a;border:none}
.btn.warn{background:linear-gradient(180deg,#fca5a5,#ef4444);color:#5b0b0b;border:none}
.progress{height:12px;background:#e5e7eb;border:1px solid #e5e7eb;border-radius:999px;overflow:hidden;margin-top:10px}
.progress > div{height:100%;background:linear-gradient(90deg,#60a5fa,#3b82f6);width:0%}
.kv{display:grid;grid-template-columns: 1fr auto auto;align-items:center;gap:8px;padding:12px;border-radius:12px;border:1px solid var(--border);background:var(--surface-2)}
.kv .eu{font-weight:800}
.kv small{color:var(--muted)}
.kv .speak{background:transparent;border:none;font-size:20px;cursor:pointer;color:#2563eb}
.section-title{display:flex;align-items:center;gap:10px;margin:8px 0}
.section-title h3{margin:0}
.list{display:grid;gap:8px}
.lesson-list{display:grid;gap:8px}
.lesson-item{display:flex;align-items:center;justify-content:space-between;padding:14px;border:1px solid var(--border);border-radius:12px;background:var(--surface)}
.lesson-item .meta{display:flex;gap:10px;align-items:center}
.tag{font-size:12px;padding:4px 8px;border:1px solid #bfdbfe;border-radius:999px;color:#1d4ed8;background:#eff6ff}
hr{border:none;border-top:1px solid var(--border);margin:8px 0}
.q{display:grid;gap:12px}
.q .prompt{font-weight:800;font-size:18px}
.options{display:grid;gap:10px}
.option{padding:14px;text-align:left;border:1px solid var(--border);border-radius:12px;background:#ffffff;color:var(--text);cursor:pointer;min-height:48px}
.option:disabled{opacity:.6;cursor:not-allowed}
.feedback{min-height:22px}
.feedback.ok{color:var(--ok)}
.feedback.no{color:var(--warn)}
.explain{color:var(--muted);font-size:14px}
.input{width:100%;padding:14px;border-radius:12px;border:1px solid var(--border);background:#ffffff;color:var(--text);min-height:48px}
.wordbank{display:flex;flex-wrap:wrap;gap:8px}
.tile{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#ffffff;cursor:pointer}
.answer-strip{display:flex;flex-wrap:wrap;gap:8px;min-height:44px;padding:8px;border:1px dashed #d1d5db;border-radius:12px;background:#f8fafc}
.answer-token{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#e5efff}
footer{max-width:1000px;margin:30px auto;padding:0 16px;color:var(--muted);text-align:center}
.hide{display:none !important}

/* Better mobile layout */
@media (max-width: 879px){
  .controls{gap:12px}
  .btn, .option{width:100%}
  .kv{grid-template-columns: 1fr auto}
}
  </style>
</head>
<body>
  <header>
    <div class="container brand">
      <div class="logo">EU</div>
      <div class="title">
        <h1>Euskara Â· Ikasi</h1>
        <small>Niveau 1 â€¢ 10 leÃ§ons â€¢ Basque batua</small>
      </div>
    </div>
  </header>

  <main class="container grid">
    <!-- LEFT: Lesson picker + vocab -->
    <div class="card" id="picker">
      <div class="section-title">
        <span class="badge">Parcours DÃ©butant</span>
        <h3>Choisis une leÃ§on</h3>
      </div>
      <div class="lesson-list" id="lesson-list"></div>
      <hr />
      <div>
        <h3>Vocabulaire (aperÃ§u)</h3>
        <div class="list" id="vocab-preview"></div>
        <div class="controls">
          <button class="btn" id="tts-all">ðŸ”Š Tout Ã©couter</button>
          <button class="btn primary" id="start">Commencer les exercices</button>
        </div>
        <div class="progress" aria-label="Progression leÃ§on"><div id="progress"></div></div>
      </div>
    </div>

    <!-- RIGHT: Quiz -->
    <div class="card" id="quiz-area">
      <div class="section-title">
        <span class="badge" id="lesson-badge">LeÃ§on</span>
        <h3 id="lesson-title">â€”</h3>
      </div>
      <div class="q">
        <div class="prompt" id="q-prompt"></div>
        <div class="options" id="q-options"></div>

        <!-- WORD BANK MODE -->
        <div id="bank-wrap" class="hide">
          <div class="answer-strip" id="answer-strip" aria-label="RÃ©ponse"></div>
          <div class="wordbank" id="wordbank"></div>
          <div class="controls">
            <button class="btn ghost" id="bank-undo">Effacer le dernier</button>
            <button class="btn warn" id="bank-clear">Tout effacer</button>
          </div>
        </div>

        <div class="feedback" id="feedback"></div>
        <div class="explain" id="explain"></div>
        <div class="controls">
          <button class="btn ghost" id="prev">â—€ PrÃ©cÃ©dent</button>
          <button class="btn primary" id="next" disabled>Suivant â–¶</button>
          <button class="btn ok hide" id="finish">Terminer</button>
        </div>
      </div>
    </div>
  </main>

  <footer>Light UI â€¢ autoâ€‘avance sur bonne rÃ©ponse â€¢ banque de mots type Duolingo â€¢ euskara batua â€¢ progression locale.</footer>

  <script>
/* =================== DATA: 10 LESSONS (BASQUE BATUA) + explanations =================== */
const LESSONS = [
  {
    id: "l1",
    title: "Agurrak Â· Salutations",
    tag: "Bases",
    vocab: [
      {eu:"Kaixo", fr:"Bonjour / Salut"},
      {eu:"Egun on", fr:"Bonjour (matin)"},
      {eu:"Arratsalde on", fr:"Bon aprÃ¨s-midi"},
      {eu:"Gabon", fr:"Bonsoir / Bonne nuit"},
      {eu:"Agur", fr:"Au revoir"}
    ],
    questions: [
      {type:"mcq", prompt:"Â« Bonjour (matin) Â» en euskara batua ?", options:["Egun on","Kaixo","Gabon","Arratsalde on"], answer:"Egun on", explain:"Â«Egun onÂ» sâ€™emploie le matin. Â«KaixoÂ» = salut/gÃ©nÃ©ral."},
      {type:"mcq", prompt:"Que signifie Â« Agur Â» ?", options:["Merci","Au revoir","S'il te plaÃ®t","Ã€ demain"], answer:"Au revoir", explain:"Â«AgurÂ» = au revoir."},
      {type:"mcq", prompt:"Choisis la bonne traduction : Â« Gabon Â»", options:["Bonsoir/Bonne nuit","Bonjour","Bon aprÃ¨s-midi","Salut"], answer:"Bonsoir/Bonne nuit", explain:"Â«GabonÂ» sâ€™utilise le soir/nuit."},
      {type:"bank", prompt:"Forme gÃ©nÃ©rale : Â« Bonjour / Salut Â»", acceptable:["kaixo"], bank:["kaixo","egun","on","agur","gabon","arratsalde","on"], explain:"RÃ©ponse attendue : Kaixo."},
      {type:"bank", prompt:"Compose Â« Bon aprÃ¨sâ€‘midi Â»", acceptable:["arratsalde on","arratsaldeon"], bank:["arratsalde","on","egun","gabon","kaixo","mesedez"], explain:"Deux orthographes: Â«arratsalde onÂ» ou Â«arratsaldeonÂ»."}
    ]
  },
  {
    id: "l2",
    title: "Adeitasuna Â· Politesse",
    tag: "Bases",
    vocab: [
      {eu:"Eskerrik asko", fr:"Merci beaucoup"},
      {eu:"Mesedez", fr:"S'il vous plaÃ®t"},
      {eu:"Barkatu", fr:"Pardon / Excusezâ€‘moi"},
      {eu:"Ez dut ulertzen", fr:"Je ne comprends pas"},
      {eu:"Polikiago, mesedez", fr:"Plus lentement, s'il vous plaÃ®t"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« Merci beaucoup Â» en basque ?", options:["Eskerrik asko","Mila esker","Mesedez","Ondo"], answer:"Eskerrik asko", explain:"Â«Eskerrik askoÂ» (batua). Â«Mila eskerÂ» = merci (mille mercis)."},
      {type:"mcq", prompt:"Â« Mesedez Â» signifieâ€¦", options:["Excusez-moi","S'il vous plaÃ®t","Bonjour","Au revoir"], answer:"S'il vous plaÃ®t", explain:"Pour formuler une demande polie."},
      {type:"mcq", prompt:"Traduction de Â« Ez dut ulertzen Â»", options:["Je comprends","Je ne comprends pas","Parlez plus fort","OÃ¹ sont les toilettes ?"], answer:"Je ne comprends pas", explain:"Â«Ez dut ulertzenÂ» = je ne comprends pas."},
      {type:"bank", prompt:"Compose Â« Excusezâ€‘moi Â»", acceptable:["barkatu"], bank:["barkatu","eskerrik","asko","mesedez","kaixo"], explain:"Â«BarkatuÂ» sert Ã  sâ€™excuser / demander Ã  passer."},
      {type:"bank", prompt:"Compose Â« Plus lentement, sâ€™il vous plaÃ®t Â»", acceptable:["polikiago, mesedez","polikiago mesedez"], bank:["polikiago,","mesedez","polikiago","egun","on","eskerrik","asko"], explain:"Â«PolikiagoÂ» = plus lentement."}
    ]
  },
  {
    id: "l3",
    title: "Aurkezpena Â· Se prÃ©senter",
    tag: "Conversation",
    vocab: [
      {eu:"Nire izena â€¦ da", fr:"Je m'appelle â€¦"},
      {eu:"Ni Manu naiz", fr:"Je suis Manu"},
      {eu:"Non bizi zara?", fr:"OÃ¹ habitesâ€‘tu ?"},
      {eu:"Ni Donostian bizi naiz", fr:"J'habite Ã  Saintâ€‘SÃ©bastien"},
      {eu:"Zer moduz?", fr:"Comment Ã§a va ?"},
      {eu:"Ondo / Oso ondo / Gaizki", fr:"Bien / TrÃ¨s bien / Mal"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« Je m'appelle Ainhoa Â»", options:["Nire izena Ainhoa da","Ni Ainhoa zara","Ainhoa naiz nire izena","Nire izena da Ainhoa"], answer:"Nire izena Ainhoa da", explain:"Structure batua: Â«Nire izena X daÂ»."},
      {type:"mcq", prompt:"Â« OÃ¹ habitesâ€‘tu ? Â»", options:["Non bizi zara?","Non zaude?","Non bizi naiz?","Nor zara?"], answer:"Non bizi zara?", explain:"Â«Bizi izanÂ» = habiter; Â«Nonâ€¦?Â» = oÃ¹."},
      {type:"bank", prompt:"Compose Â« Je suis Manu Â»", acceptable:["ni manu naiz"], bank:["ni","Manu","naiz","nago","zara","da"], explain:"Avec Â«izanÂ» (Ãªtre identitaire) â†’ Â«ni â€¦ naizÂ»."},
      {type:"bank", prompt:"Compose la question Â« Comment Ã§a va ? Â»", acceptable:["zer moduz?","zer moduz"], bank:["zer","moduz","?","non","zara","ondo"], explain:"Formule courante, neutre."},
      {type:"mcq", prompt:"Choisis Â« J'habite Ã  Donostia Â»", options:["Ni Donostian bizi naiz","Ni Donostiara noa","Ni Donostian nago","Donostia dut"], answer:"Ni Donostian bizi naiz", explain:"Â«-nÂ» locatif : Donostia-n + Â«bizi naizÂ»."}
    ]
  },
  {
    id: "l4",
    title: "Behar oinarrizkoak Â· Besoins",
    tag: "Survie",
    vocab: [
      {eu:"Ura nahi dut", fr:"Je veux de l'eau"},
      {eu:"Kafe bat, mesedez", fr:"Un cafÃ©, s'il vous plaÃ®t"},
      {eu:"Non dago komuna?", fr:"OÃ¹ sont les toilettes ?"},
      {eu:"Zenbat da?", fr:"C'est combien ?"},
      {eu:"Lagundu nazakezu?", fr:"Pouvezâ€‘vous m'aider ?"}
    ],
    questions:[
      {type:"mcq", prompt:"Traduction de Â« Non dago komuna? Â»", options:["OÃ¹ est la gare ?","OÃ¹ sont les toilettes ?","OÃ¹ est l'hÃ´tel ?","OÃ¹ est la plage ?"], answer:"OÃ¹ sont les toilettes ?", explain:"Â«Non dagoâ€¦?Â» = OÃ¹ estâ€¦ ? Â«KomunaÂ» = toilettes."},
      {type:"bank", prompt:"Compose Â« Je veux de lâ€™eau Â»", acceptable:["ura nahi dut"], bank:["ura","nahi","dut","kafe","bat","mesedez"], explain:"Â«nahi dutÂ» = je veux; Â«uraÂ» = lâ€™eau."},
      {type:"mcq", prompt:"Â« C'est combien ? Â»", options:["Zenbat da?","Zenbat gara?","Zenbat dugu?","Zenbat dena?"], answer:"Zenbat da?", explain:"Forme fixe batua pour demander le prix."},
      {type:"bank", prompt:"Compose Â« Un cafÃ©, s'il vous plaÃ®t Â»", acceptable:["kafe bat, mesedez","kafe bat mesedez"], bank:["kafe","bat,","mesedez","bat","egun","on"], explain:"Â«batÂ» = un/une."},
      {type:"mcq", prompt:"Â« Lagundu nazakezu? Â» signifieâ€¦", options:["Avezâ€‘vous du temps ?","Pouvezâ€‘vous m'aider ?","OÃ¹ vaisâ€‘je ?","Parlez plus doucement"], answer:"Pouvezâ€‘vous m'aider ?", explain:"Forme polie/standard pour demander de lâ€™aide."}
    ]
  },
  {
    id: "l5",
    title: "Zenbakiak eta egunak Â· Nombres & jours",
    tag: "Bases",
    vocab: [
      {eu:"bat, bi, hiru, lau, bost", fr:"1, 2, 3, 4, 5"},
      {eu:"sei, zazpi, zortzi, bederatzi, hamar", fr:"6, 7, 8, 9, 10"},
      {eu:"astelehena", fr:"lundi"},
      {eu:"asteartea", fr:"mardi"},
      {eu:"asteazkena", fr:"mercredi"},
      {eu:"osteguna / ostirala", fr:"jeudi / vendredi"},
      {eu:"larunbata / igandea", fr:"samedi / dimanche"}
    ],
    questions:[
      {type:"mcq", prompt:"Choisis Â« 7 Â» en basque", options:["zazpi","zortzi","sei","bederatzi"], answer:"zazpi", explain:"7 = zazpi; 8 = zortzi; 9 = bederatzi."},
      {type:"mcq", prompt:"Â« osteguna Â» = ", options:["jeudi","vendredi","samedi","dimanche"], answer:"jeudi", explain:"Â«ostiralaÂ» = vendredi."},
      {type:"bank", prompt:"Compose le chiffre Â« trois Â»", acceptable:["hiru"], bank:["bat","bi","hiru","lau","bost"], explain:"1 bat, 2 bi, 3 hiru."},
      {type:"mcq", prompt:"Â« asteazkena Â»", options:["mercredi","mardi","jeudi","samedi"], answer:"mercredi", explain:"Litt. Â«milieu de semaineÂ»."},
      {type:"bank", prompt:"Compose Â« dix Â»", acceptable:["hamar"], bank:["hamar","zazpi","zortzi"], explain:"10 = hamar."}
    ]
  },
  {
    id: "l6",
    title: "Familia Â· Famille",
    tag: "Vie",
    vocab: [
      {eu:"ama", fr:"mÃ¨re"},
      {eu:"aita", fr:"pÃ¨re"},
      {eu:"semea / alaba", fr:"fils / fille"},
      {eu:"anai / arreba", fr:"frÃ¨re / sÅ“ur (parlant = homme)"},
      {eu:"neba / ahizpa", fr:"frÃ¨re / sÅ“ur (parlant = femme)"},
      {eu:"laguna", fr:"ami(e) / partenaire (selon contexte)"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« ama Â»", options:["mÃ¨re","pÃ¨re","tante","grandâ€‘mÃ¨re"], answer:"mÃ¨re", explain:"Ama = mÃ¨re, Aita = pÃ¨re."},
      {type:"mcq", prompt:"Â« alaba Â»", options:["fille","fils","soeur","mÃ¨re"], answer:"fille", explain:"Â«semeaÂ» = fils."},
      {type:"bank", prompt:"Compose Â« pÃ¨re Â»", acceptable:["aita"], bank:["aita","ama","anai","arreba"], explain:"Aita = pÃ¨re."},
      {type:"mcq", prompt:"Choisis la paire correcte", options:["anai/arreba","anai/ahizpa","neba/arreba","semea/arreba"], answer:"anai/arreba", explain:"Si locuteur homme : anai/arreba; si femme : neba/ahizpa."},
      {type:"bank", prompt:"Compose Â« ami(e) Â»", acceptable:["laguna"], bank:["laguna","lagunak","lagun"], explain:"Forme basique : laguna."}
    ]
  },
  {
    id: "l7",
    title: "Jatea eta edatea Â· Manger/boire",
    tag: "Vie",
    vocab: [
      {eu:"ogi", fr:"pain"},
      {eu:"gazta", fr:"fromage"},
      {eu:"arraina / haragia", fr:"poisson / viande"},
      {eu:"barazkiak / fruta", fr:"lÃ©gumes / fruits"},
      {eu:"ura / ardoa / garagardoa", fr:"eau / vin / biÃ¨re"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« ogi Â»", options:["pain","lait","fromage","riz"], answer:"pain", explain:"Ogi = pain; gazta = fromage."},
      {type:"bank", prompt:"Compose Â« fromage Â»", acceptable:["gazta"], bank:["gazta","ogi","ardoa"], explain:"Forme batua : gazta."},
      {type:"mcq", prompt:"Â« ardoa Â»", options:["vin","eau","biÃ¨re","jus"], answer:"vin", explain:"Ardoa = vin; garagardoa = biÃ¨re."},
      {type:"bank", prompt:"Compose Â« eau Â»", acceptable:["ura"], bank:["ura","garagardoa","ogi"], explain:"Ura = lâ€™eau."},
      {type:"mcq", prompt:"Â« arraina Â»", options:["poisson","viande","salade","pomme"], answer:"poisson", explain:"Arraina = poisson; haragia = viande."}
    ]
  },
  {
    id: "l8",
    title: "Tokian toki Â· Lieux & directions",
    tag: "Survie",
    vocab: [
      {eu:"Non dago â€¦?", fr:"OÃ¹ est â€¦ ?"},
      {eu:"ezker / eskuin", fr:"gauche / droite"},
      {eu:"zuzen", fr:"tout droit"},
      {eu:"gertu / urrun", fr:"prÃ¨s / loin"},
      {eu:"plaza / kalea / geltokia", fr:"place / rue / gare"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« ezker Â»", options:["gauche","droite","loin","prÃ¨s"], answer:"gauche", explain:"Eskuina = droite."},
      {type:"mcq", prompt:"Traduction de Â« zuzen Â»", options:["tout droit","Ã  gauche","lentement","plus tard"], answer:"tout droit", explain:"Â«Zuzen joanÂ» = aller tout droit."},
      {type:"bank", prompt:"Compose Â« OÃ¹ est la gare ? Â»", acceptable:["non dago geltokia?","non dago geltokia"], bank:["non","dago","geltokia","?","kaixo","gertu"], explain:"Â«geltokiaÂ» = la gare."},
      {type:"mcq", prompt:"Â« gertu Â»", options:["prÃ¨s","loin","haut","bas"], answer:"prÃ¨s", explain:"Â«urrunÂ» = loin."},
      {type:"bank", prompt:"Compose Â« droite Â»", acceptable:["eskuin"], bank:["eskuin","ezker","zuzen"], explain:"Eskuina = Ã  droite."}
    ]
  },
  {
    id: "l9",
    title: "Ordua eta egunerokoa Â· Temps & routine",
    tag: "Vie",
    vocab: [
      {eu:"Noiz?", fr:"Quand ?"},
      {eu:"Gaur / bihar / atzo", fr:"aujourd'hui / demain / hier"},
      {eu:"goizean / arratsaldean / gauean", fr:"le matin / l'aprÃ¨sâ€‘midi / le soir"},
      {eu:"Goizeko bederatzietan", fr:"Ã€ neuf heures du matin"},
      {eu:"Astelehenetan lana dut", fr:"Le lundi, j'ai du travail"}
    ],
    questions:[
      {type:"mcq", prompt:"Â« bihar Â»", options:["demain","hier","aujourd'hui","tout de suite"], answer:"demain", explain:"Gaur = aujourdâ€™hui; atzo = hier."},
      {type:"mcq", prompt:"Â« Noiz? Â» = ", options:["Quand ?","OÃ¹ ?","Qui ?","Combien ?"], answer:"Quand ?", explain:"Question de temps."},
      {type:"bank", prompt:"Compose Â« aujourd'hui Â»", acceptable:["gaur"], bank:["gaur","bihar","atzo"], explain:"Forme batua : gaur."},
      {type:"mcq", prompt:"Â« goizean Â»", options:["le matin","le soir","demain","hier"], answer:"le matin", explain:"Â«arratsaldeanÂ» = lâ€™aprÃ¨sâ€‘midi; Â«gaueanÂ» = le soir."},
      {type:"bank", prompt:"Compose Â« Ã€ neuf heures du matin Â»", acceptable:["goizeko bederatzietan"], bank:["goizeko","bederatzietan","gauean","arratsaldean"], explain:"Structure temps + locatif Â«â€‘tan/â€‘etanÂ»."}
    ]
  },
  {
    id: "l10",
    title: "Aditzak oinarri Â· Verbes de base",
    tag: "Grammaire",
    vocab: [
      {eu:"izan (Ãªtre, ident.)", fr:"ni naiz / zu zara / hura da"},
      {eu:"egon (Ãªtre, lieu/Ã©tat)", fr:"ni nago / zu zaude / hura dago"},
      {eu:"eduki (avoir)", fr:"badut / baduzu / badu"},
      {eu:"joan (aller)", fr:"noa / zoaz / doa"},
      {eu:"etorri (venir)", fr:"nator / zatoz / dator"}
    ],
    questions:[
      {type:"mcq", prompt:"Choisis Â« Je suis Â» (identitÃ©)", options:["ni naiz","ni nago","ni dut","ni noa"], answer:"ni naiz", explain:"Â«izanÂ» = Ãªtre identitaire; Â«egonÂ» = Ã©tat/lieu."},
      {type:"mcq", prompt:"Â« Il est (se trouve) Â» â†’ egon", options:["hura dago","hura da","hura doa","hura dator"], answer:"hura dago", explain:"Avec Â«egonÂ»: dago/zaude/nagoâ€¦"},
      {type:"bank", prompt:"Compose Â« Je vais Â» (joan)", acceptable:["noa"], bank:["noa","nator","naiz"], explain:"Â«joanÂ» (aller) â†’ noa (je)."},
      {type:"bank", prompt:"Compose Â« Je viens Â» (etorri)", acceptable:["nator"], bank:["nator","noa","nago"], explain:"Â«etorriÂ» (venir) â†’ nator (je)."},
      {type:"mcq", prompt:"Forme correcte de Â« avoir Â» : Â« Il/elle a Â»", options:["badut","badu","baduzu","badugu"], answer:"badu", explain:"eduki â†’ badu (il/elle a)."}
    ]
  }
];

/* =================== AUDIO FEEDBACK (Web Audio API) =================== */
let audioCtx = null;
function beepOK(){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type="sine"; o.frequency.value = 880;
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.15);
  o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.16);
}
function beepNO(){
  if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type="square"; o.frequency.value = 220;
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.2, audioCtx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.25);
  o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.26);
}

/* =================== APP LOGIC =================== */
function $(s, r=document){ return r.querySelector(s) }
function $all(s, r=document){ return Array.from(r.querySelectorAll(s)) }
function norm(s){ return s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim() }

const state = { currentLesson: LESSONS[0].id, qIndex: 0, score: 0, order: [], answered:false };

function speak(text){
  if(!("speechSynthesis" in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  const voices = speechSynthesis.getVoices();
  const v = voices.find(v=>/eu|basque/i.test(v.lang)) || voices.find(v=>/es-ES|es/i.test(v.lang));
  if (v) u.voice = v;
  u.rate = 0.95;
  speechSynthesis.speak(u);
}

function saveProgress(){
  const key = "eu_progress_"+state.currentLesson;
  const data = {score: state.score, total: getQ().length, ts: Date.now()};
  localStorage.setItem(key, JSON.stringify(data));
}

function loadProgress(lessonId){
  try { return JSON.parse(localStorage.getItem("eu_progress_"+lessonId)) } catch(e){ return null }
}

function shuffle(arr){ return arr.map(x=>[Math.random(),x]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
function getLesson(){ return LESSONS.find(l=>l.id===state.currentLesson); }
function getQ(){ return getLesson().questions; }
function updateProgressBar(){
  const pct = Math.round((state.qIndex / getQ().length) * 100);
  $("#progress").style.width = pct + "%";
}

function renderLessons(){
  const list = $("#lesson-list"); list.innerHTML="";
  LESSONS.forEach((l, idx)=>{
    const saved = loadProgress(l.id);
    const div = document.createElement("div");
    div.className = "lesson-item";
    div.innerHTML = `
      <div class="meta"><span class="tag">${l.tag}</span><strong>${idx+1}. ${l.title}</strong></div>
      <div>${saved ? `<small>Score: ${saved.score}/${saved.total}</small>` : `<small class="muted">Nouveau</small>`}</div>`;
    div.addEventListener("click", ()=> selectLesson(l.id));
    list.appendChild(div);
  });
}

function renderVocabPreview(){
  const box = $("#vocab-preview"); box.innerHTML="";
  const lesson = getLesson();
  lesson.vocab.forEach(row=>{
    const div = document.createElement("div");
    div.className = "kv";
    div.innerHTML = `<div class="eu">${row.eu} ${row.note?`<small>Â· ${row.note}</small>`:""}</div>
                     <div class="fr">${row.fr}</div>
                     <button class="speak" title="Ã‰couter" aria-label="Ã‰couter ${row.eu}">ðŸ”Š</button>`;
    div.querySelector(".speak").addEventListener("click", ()=> speak(row.eu));
    box.appendChild(div);
  });
  $("#lesson-badge").textContent = "LeÃ§on " + (LESSONS.findIndex(x=>x.id===state.currentLesson)+1);
  $("#lesson-title").textContent = lesson.title;
}

function selectLesson(id){
  state.currentLesson = id;
  state.qIndex = 0;
  state.score = 0;
  state.order = shuffle(getQ().slice());
  renderVocabPreview();
  renderQuestion();
  updateProgressBar();
}

function showExplain(q, userVal, correct){
  const ex = $("#explain");
  let extra = q.explain ? " " + q.explain : "";
  if (q.type === "bank" && userVal !== undefined){
    ex.innerHTML = `Tu as composÃ© : <code>${userVal || "â€”"}</code>. Attendu : <strong>${(q.acceptable||[correct])[0] || correct}</strong>.${extra? "<br>"+extra:""}`;
  } else {
    ex.textContent = extra.trim();
  }
}

function renderQuestion(){
  const q = state.order[state.qIndex] || state.order[0];
  $("#q-prompt").textContent = q.prompt;
  $("#feedback").textContent = "";
  $("#explain").textContent = "";
  $("#bank-wrap").classList.add("hide");
  $("#finish").classList.add("hide");
  $("#next").disabled = true;
  state.answered = false;
  const opts = $("#q-options"); opts.innerHTML="";

  if (q.type === "mcq"){
    q.options.forEach(op=>{
      const b = document.createElement("button");
      b.className = "option";
      b.textContent = op;
      b.addEventListener("click", ()=>{
        if (state.answered) return;
        const ok = norm(op) === norm(q.answer);
        endQuestion(ok, q, op, q.answer, /*autoAdvance*/ ok);
      });
      opts.appendChild(b);
    });
  } else if (q.type === "bank"){
    $("#q-options").innerHTML = "";
    $("#bank-wrap").classList.remove("hide");
    setupWordBank(q);
  }

  $("#prev").disabled = state.qIndex===0;
  if (state.qIndex>=getQ().length-1){ $("#finish").classList.remove("hide"); }
}

let bankState = { built: [] };

function setupWordBank(q){
  bankState.built = [];
  const strip = $("#answer-strip");
  const wb = $("#wordbank");
  strip.innerHTML = "";
  wb.innerHTML = "";
  const pool = shuffle([...(q.bank||[]), ...((q.distractors||[]))]);
  pool.forEach(tok=>{
    const btn = document.createElement("button");
    btn.className = "tile";
    btn.textContent = tok;
    btn.addEventListener("click", ()=>{
      if (state.answered) return;
      bankState.built.push(tok);
      renderBankAnswer();
      checkBank(q);
    });
    wb.appendChild(btn);
  });
  $("#bank-undo").onclick = ()=>{
    if (state.answered) return;
    bankState.built.pop();
    renderBankAnswer();
  };
  $("#bank-clear").onclick = ()=>{
    if (state.answered) return;
    bankState.built = [];
    renderBankAnswer();
  };
  function renderBankAnswer(){
    strip.innerHTML = "";
    bankState.built.forEach(t=>{
      const s = document.createElement("span");
      s.className = "answer-token";
      s.textContent = t;
      strip.appendChild(s);
    });
  }
  function checkBank(q){
    const user = bankState.built.join(" ").replace(" ,", ",").replace(" ?", "?");
    const ok = (q.acceptable||[]).some(a => norm(a) === norm(user));
    if (ok){
      endQuestion(true, q, user, (q.acceptable||[])[0], /*autoAdvance*/ true);
    }
  }
}

function endQuestion(ok, q, userVal, correct, autoAdvance=false){
  state.answered = true;
  if (ok){ state.score++; $("#feedback").textContent = "âœ… Zorionak!"; $("#feedback").className="feedback ok"; beepOK(); }
  else { $("#feedback").textContent = "âŒ Erreur"; $("#feedback").className="feedback no"; beepNO(); }
  // disable mcq buttons
  $all(".option").forEach(b=> b.disabled = true);
  // explanation area
  showExplain(q, userVal, correct);
  // next handling
  if (autoAdvance){
    setTimeout(()=> nextQ(+1), 800); // auto-advance on correct
  } else {
    setTimeout(()=>{ $("#next").disabled = false; }, 600);
  }
  updateProgressBar();
}

function nextQ(delta){
  if (!state.answered && delta>0){
    $("#feedback").textContent = "RÃ©ponds avant de continuer.";
    return;
  }
  const len = getQ().length;
  let ni = state.qIndex + delta;
  if (ni < 0) ni = 0;
  if (ni >= len) ni = len-1;
  state.qIndex = ni;
  renderQuestion();
}

function finishLesson(){
  if (!state.answered){ $("#feedback").textContent = "RÃ©ponds Ã  la question en cours."; return; }
  saveProgress();
  const total = getQ().length;
  const txt = `Score: ${state.score}/${total}`;
  alert(txt);
  // reset for replay
  state.qIndex = 0; state.score = 0; state.order = shuffle(getQ().slice());
  renderQuestion(); updateProgressBar();
}

window.addEventListener("DOMContentLoaded", ()=>{
  renderLessons();
  selectLesson(LESSONS[0].id);
  $("#start").onclick = ()=>{ state.qIndex=0; state.score=0; state.order=shuffle(getQ().slice()); renderQuestion(); updateProgressBar(); };
  $("#tts-all").onclick = ()=>{
    const list = getLesson().vocab.map(v=>v.eu);
    let i=0;
    function step(){ if (i>=list.length) return; speak(list[i++]); setTimeout(step, 650); }
    step();
  };
  $("#prev").onclick = ()=> nextQ(-1);
  $("#next").onclick = ()=> nextQ(+1);
  $("#finish").onclick = finishLesson;
  if (window.speechSynthesis) window.speechSynthesis.getVoices();
  // Resume AudioContext on first user gesture (iOS policy)
  window.addEventListener('touchstart', ()=>{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }, {once:true});
  window.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }, {once:true});
});
  </script>
</body>
</html>
